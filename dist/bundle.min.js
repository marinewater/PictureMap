!function(){"use strict";function r(e){for(;e.hasChildNodes();)e.removeChild(e.lastChild)}function s(e){var t=document.createElement("img");return t.src=e.BlobUrl,t.alt=e.Name,t.title=e.Name,t}function n(e){var t=document.querySelector(".loader");!0===e?t.classList.remove("hidden"):t.classList.add("hidden")}function o(e){void 0===e&&(e=!0),document.getElementById("image").disabled=e}function p(e){var t=document.querySelector(".modal"),a=document.querySelector(".modal-image-container");r(a);var n=s(e);n.classList.add("modal-image"),a.appendChild(n),document.querySelector(".modal-heading h1").innerText=e.Name;var i=document.querySelector(".modal-data");r(i),i.appendChild(function(e){var t=document.createElement("ul");for(var a in e.MetaData)if(e.MetaData.hasOwnProperty(a)){var n=document.createElement("li"),i=document.createElement("b"),r=document.createTextNode(a+": ");i.appendChild(r),n.appendChild(i);var o=void 0;o=Array.isArray(e.MetaData[a])?e.MetaData[a].join(", "):"object"==typeof e.MetaData[a]?JSON.stringify(e.MetaData[a],null,4):e.MetaData[a].toString(),n.appendChild(document.createTextNode(o)),t.appendChild(n)}return t}(e)),t.style.visibility="visible",document.querySelector(".modal-close > .close-icon").addEventListener("click",function(e){e.preventDefault(),document.querySelector(".modal").style.visibility="hidden"})}var i=function(){function i(e,t,a){this._pictures=[],this._imageInputElement=e,this._imageGrid=t,this._map=L.map(a),L.tileLayer("http://tile.stamen.com/terrain/{z}/{x}/{y}.jpg",{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',maxZoom:16}).addTo(this._map),this._map.setView([51.502654,-.124225],10)}return i.prototype.getData=function(){var t=this;o(),n(!0);for(var e=[],a=0;a<this._imageInputElement.files.length;a++)e.push(this._imageInputElement.files[a]);return this._getImageData(e).then(function(e){return t._renderMap(e)}).then(function(){return t._list_images()}).then(function(){return n(!1)}).then(function(){return o(!1)})},i.prototype._getImageData=function(e){return new Promise(function(t,a){var n=new Worker("dist/worker.min.js");n.onmessage=function(e){t(e.data.map(function(e){return{LonLat:i._parseGeoData(e.meta_data),Name:e.file_name,BinaryImage:e.binary,MetaData:e.meta_data}})),n.terminate()},n.onerror=function(e){a(e),n.terminate()},n.postMessage(e)})},i.prototype.zoomToAll=function(){var e=this._pictures.filter(function(e){return null!==e.Marker});if(0<e.length){var t=e.map(function(e){return e.Marker}),a=new L.featureGroup(t);this._map.fitBounds(a.getBounds())}},i._parseGeoData=function(e){return void 0===e.GPSLatitude||void 0===e.GPSLatitudeRef||void 0===e.GPSLongitude||void 0===e.GPSLongitudeRef?null:{Latitude:i._convertDMSToDD(parseInt(e.GPSLatitude[0],10),parseInt(e.GPSLatitude[1],10),parseFloat(e.GPSLatitude[2]),e.GPSLatitudeRef),Longitude:i._convertDMSToDD(parseInt(e.GPSLongitude[0],10),parseInt(e.GPSLongitude[1],10),parseFloat(e.GPSLongitude[2]),e.GPSLongitudeRef)}},i._convertDMSToDD=function(e,t,a,n){var i=e+t/60+a/3600;return"S"!=n&&"W"!=n||(i*=-1),i},i.prototype._renderMap=function(e){var l=this,m=[];if(e.forEach(function(e){var t,a,n,i={Marker:null,Name:e.Name,BlobUrl:(t=e.BinaryImage,a=new Uint8Array(t),n=new Blob([a],{type:"image/jpeg"}),(window.URL||window.webkitURL).createObjectURL(n)),MetaData:e.MetaData};if(null!==e.LonLat){var r=document.createElement("div"),o=document.createElement("p"),d=document.createTextNode(e.Name);o.appendChild(d),r.appendChild(o);var u=s(i);u.addEventListener("click",function(){return p(i)}),r.appendChild(u);var c=L.marker([e.LonLat.Latitude,e.LonLat.Longitude]).addTo(l._map);c.bindPopup(r).openPopup(),m.push(c),i.Marker=c}l._pictures.push(i)}),0<m.length){var t=new L.featureGroup(m);this._map.fitBounds(t.getBounds())}},i.prototype._list_images=function(){var a,n,e,t=this._pictures.sort(function(e,t){return e.Name.localeCompare(t.Name,void 0,{sensitivity:"base"})});a=this._map,n=this._imageGrid,e=t,r(n),e.forEach(function(e){var t=document.createElement("div");t.classList.add("image"),t.appendChild(s(e)),null!==e.Marker?t.addEventListener("click",function(){a.setView(e.Marker.getLatLng(),13,{animate:!0}),e.Marker.openPopup()}):t.classList.add("no-gps"),n.appendChild(t)})},i}();window.addEventListener("DOMContentLoaded",function(){return e=document.getElementById("image"),t=document.getElementById("image-grid"),a=new i(e,t,"map"),e.addEventListener("change",function(){return a.getData()}),void document.getElementById("fit-all").addEventListener("click",function(e){e.preventDefault(),a.zoomToAll()});var e,t,a},!0)}();
//# sourceMappingURL=bundle.min.js.map
